import requests,json,hashlib,hmac,uuid,datetime;from flask import current_app;class AntiGravityIntegrationService:@staticmethod
def sync_validation_to_antiGravity(validation_id,data):uuid_str=str(uuid.uuid4());timestamp=datetime.datetime.utcnow().isoformat();payload={'validation_id':validation_id,'uuid':uuid_str,'timestamp':timestamp,'data':data};signature=hmac.new(current_app.config.get('ANTIGRAVITY_SECRET').encode(),'POST'.encode()+json.dumps(payload).encode(),hashlib.sha256).hexdigest();headers={'Authorization':f'Bearer {current_app.config.get("ANTIGRAVITY_API_KEY")}','X-Signature':signature,'X-Timestamp':timestamp,'Content-Type':'application/json'};try:response=requests.post(f'{current_app.config.get("ANTIGRAVITY_API_URL")}/validation/sync',json=payload,headers=headers,timeout=30);response.raise_for_status();return{'status':'success','antigravity_id':response.json().get('antigravity_id'),'sync_timestamp':timestamp}except requests.exceptions.RequestException as e:return{'status':'error','message':str(e),'retry_count':0}@staticmethod
def get_validation_status(antigravity_id):try:headers={'Authorization':f'Bearer {current_app.config.get("ANTIGRAVITY_API_KEY")}','Content-Type':'application/json'};response=requests.get(f'{current_app.config.get("ANTIGRAVITY_API_URL")}/validation/{antigravity_id}',headers=headers,timeout=30);response.raise_for_status();return response.json()except requests.exceptions.RequestException as e:return{'status':'error','message':str(e)}
